---
- name: Create directories
  become: yes
  become_user: "{{ user }}"
  file:
    path: "{{ item }}"
    state: directory
    mode: 0775
  with_items:
    - "{{ home }}/Backup"
    - "{{ home }}/bin"
    - "{{ home }}/Documents"
    - "{{ home }}/Downloads"
    - "{{ home }}/Downloads/Torrent"
    - "{{ home }}/etc"
    - "{{ home }}/Games"
    - "{{ home }}/Games/Steam"
    - "{{ home }}/Music"
    - "{{ home }}/Notes"
    - "{{ home }}/opt"
    - "{{ home }}/opt/plantuml"
    - "{{ home }}/org"
    - "{{ home }}/org/lists"
    - "{{ home }}/org/mobile"
    - "{{ home }}/org/projects"
    - "{{ home }}/Pictures"
    - "{{ home }}/Scripts"
    - "{{ home }}/Shared"
    - "{{ home }}/src"
    - "{{ home }}/tmp"
    - "{{ home }}/Videos"
    - "{{ home }}/Workspace"
    - "{{ home }}/.gradle"
    - "{{ home }}/.var"
    - "{{ home }}/.ansible"
    - "{{ home }}/.ansible/tmp"
    - "{{ home }}/.config/Code"
    - "{{ home }}/.config/Code/User"
    - "{{ home }}/.config/fish"
    - "{{ home }}/.config/fish/functions/"
    - "{{ home }}/.vscode/DevOps"
    - "{{ home }}/.vscode/DevOps/extensions"
    - "{{ home }}/.vscode/DevOps/User"
    - "{{ home }}/.vscode/Java"
    - "{{ home }}/.vscode/Java/extensions"
    - "{{ home }}/.vscode/Java/User"
    - "{{ home }}/.vscode/JavaScript"
    - "{{ home }}/.vscode/JavaScript/extensions"
    - "{{ home }}/.vscode/JavaScript/User"

- name: "Clone repositories"
  become: yes
  become_user: "{{ user }}"
  git:
    repo: "https://github.com/{{ item.repo }}"
    dest: "{{ home }}/{{ item.dest }}"
  with_items:
    - repo: abhigenie92/unattended_upgrades_repos
      dest: src/unattended_upgrades_repos
    - repo: TylerBrock/mongo-hacker
      dest: src/mongo-hacker
    - repo: hakimel/reveal.js
      dest: opt/reveal.js
    - repo: hlissner/doom-emacs
      dest: .emacs.d
    - repo: mrkuz/dockerfiles
      dest: src/dockerfiles
    - repo: mrkuz/doom.d
      dest: etc/doom.d
    - repo: mrkuz/dotfiles
      dest: etc/dotfiles.git

- name: Link dotfiles
  become: yes
  become_user: "{{ user }}"
  file:
    src: "{{ home }}/etc/dotfiles.git/{{ item }}"
    dest: "{{ home }}/{{ item }}"
    state: link
  with_items:
    - bin/fsh
    - .bashrc.local
    - .config/Code/User/keybindings.json
    - .config/Code/User/settings.json
    - .config/fish/config.fish
    - .config/fish/fish_variables
    - .config/fish/functions/fish_prompt.fish
    - .config/fish/functions/note.fish
    - .config/fish/functions/scratch.fish
    - .config/fish/functions/todo.fish
    - .config/fish/functions/x11d.fish
    - .eclipse-java-style.xml
    - .gradle/gradle.properties
    - .inputrc
    - .tmux.conf
    - .shortcuts.json

- name: Set up vscode profiles
  become: yes
  become_user: "{{ user }}"
  file:
    src: "{{ home }}/etc/dotfiles.git/.config/Code/User/{{ item.file }}"
    dest: "{{ home }}/.vscode/{{ item.profile }}/User/{{ item.file }}"
    state: link
  with_items:
    - { profile: DevOps, file: settings.json }
    - { profile: DevOps, file: keybindings.json }
    - { profile: Java, file: settings.json }
    - { profile: Java, file: keybindings.json }
    - { profile: JavaScript, file: settings.json }
    - { profile: JavaScript, file: keybindings.json }

- name: Configure bash
  become: yes
  become_user: "{{ user }}"
  lineinfile:
    path: "{{ home }}/.bashrc"
    line: . ~/.bashrc.local

- name: Set up doom
  become: yes
  become_user: "{{ user }}"
  block:
    - name: "Link doom direcotry"
      file:
        src: "{{ home }}/etc/doom.d"
        dest: "{{ home }}/.doom.d"
        state: link
    - name: "Link doom binary"
      file:
        src: "{{ home }}/.emacs.d/bin/doom"
        dest: "{{ home }}/bin/doom"
        state: link
    - name: Initialize doom
      command: "{{ home }}/bin/doom sync"
      args:
        creates: "{{ home }}/.doom.d/config.el"

- name: Install mongo-hacker
  become: yes
  become_user: "{{ user }}"
  command: "make install"
  args:
    chdir: "{{ home }}/src/mongo-hacker"
    creates: "{{ home }}/.mongorc.js"

- name: Install plantuml
  become: yes
  become_user: "{{ user }}"
  get_url:
    url: https://downloads.sourceforge.net/project/plantuml/plantuml.jar
    dest: "{{ home}}/opt/plantuml/planuml.jar"
    mode: 0744

- name: Install fisher
  become: yes
  become_user: "{{ user }}"
  get_url:
    url: https://github.com/jorgebucaran/fisher/blob/master/fisher.fish
    dest: "{{ home}}/.config/fish/functions/fisher.fish"
    mode: 0744

- name: Set up fish
  become: yes
  become_user: "{{ user }}"
  shell: |
    set -U fish_greeting
    fisher add jethrokuan/fzf
    fisher add evanlucas/fish-kubectl-completions
    set -e FZF_COMPLETE
    echo OK > {{ home }}/.var/fish.done
  args:
    executable: /usr/bin/fish
    creates: "{{ home }}/.var/fish.done"

- name: Install sdkman
  become: yes
  become_user: "{{ user }}"
  shell: |
    export SDKMAN_DIR="{{ home }}/opt/sdkman"
    curl -s "https://get.sdkman.io" | bash
    source "{{ home }}/opt/sdkman/bin/sdkman-init.sh"
  args:
    executable: /usr/bin/bash
    creates: "{{ home }}/opt/sdkman"

- name: Install sdkman packages
  become: yes
  become_user: "{{ user }}"
  shell: |
    export SDKMAN_DIR="{{ home }}/opt/sdkman"
    source "{{ home }}/opt/sdkman/bin/sdkman-init.sh"
    sdk install {{ item }}
  args:
    executable: /usr/bin/bash
    creates: "{{ home }}/opt/sdkman/candidates/{{ item }}"
  with_items:
    - java
    - maven
    - groovy
    - gradle
    - visualvm
